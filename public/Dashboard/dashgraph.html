<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="graph.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- <script src="scriptss.js"></script> -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <title>WellScan</title>
</head>

<body>
    <nav>
        <div class="container" onclick="tochange(this)">
            <div class="bar1"></div>
            <div class="bar2"></div>
            <div class="bar3"></div>
        </div>

        <ul>
            <li>
                <a class="active" href="#Dashboard">Dashboard</a>
                <a class="active" href="/Login/page.html" id="sigout"> Sign out</a>
                <a class="active" href="/SignUp/signup.html" id="delacc"> Delete Account</a>
            </li>

        </ul>
        <div class="name">
            WellScan
        </div>
    </nav>
    <section class="Dashboard" id="dash">

        <h1 class="dashhead" id="dashH">
            Patient Information
        </h1>

        <div class="form">
            
            <form class="patientform" id="ptnf">
                
                <h4 class="patientnamehead">Patient Name</h4>
                <input class="PatientfName" id="fpn" name="FPTN" placeholder="Patients' First Name" required>
                <input class="PatientlName" id="lpn" name="LPTN" placeholder="Patients' Last Name" required>
                <h4 class="intake">
                    Enter Intake
                </h4>

                <div class="intakediv">
                    <input type="number" min="1" max="24" class="intime" id="intym" name="intakeTime"
                        placeholder="Time (In Hrs)" required>
                    <input type="number" min="1" class="BP" id="bloodP" name="BPPTN" placeholder="Blood Pressure(in ml)"
                        required>
                    <input type="number" min="1" class="pulse" id="Pulsepn" name="PPTN" placeholder="Pulse(in ml)"
                        required>
                    <input type="number" min="1" class="ORNGF" id="orngpn" name="oralPTN"
                        placeholder="Oral N.G Feed(in ml)" required>
                </div>
                <h4 class="output">
                    Enter Output
                </h4>
                <div class="outputdiv">

                    <input type="number" min="1" max="24" class="outtime" id="outtym" name="outtimePTN"
                        placeholder="Time(In Hrs)" required>
                    <input type="number" min="1" class="urine" id="urpn" name="URPTN" placeholder="Urine(in ml)"
                        required>
                    <input type="number" min="1" class="stool" id="stpn" name="STPTN" placeholder="Stool(in ml)"
                        required>
                    <input type="number" min="1" class="vomit" id="vmpn" name="VMTPNT" placeholder="Vomit(in ml)"
                        required>
                    <input type="number" min="1" class="suction" id="scpn" name="SCTPNT" placeholder="Suction(in ml)"
                        required>

                </div>
                <input class="submitp" type="submit" id="patientsubmit" value="Submit">
            </form>
        </div>
        <div class="ptdetails">
            <h2 class="pth" id="ptH"></h2>
            <div class="heads">
                <div class="firstheads">
                    <h2 class="int">Intake</h2>
                    <h4 class="ptd8" id="ptD8"></h4>
                    <h4 class="ptd1" id="ptD1"></h4>
                    <h4 class="ptd2" id="ptD2"></h4>
                    <h4 class="ptd3" id="ptD3"></h4>
                </div>
                </br>
                <h2 class="op">Output</h2>
                <div class="secondheads">
                    <h4 class="ptd9" id="ptD9"></h4>
                    <h4 class="ptd4" id="ptD4"></h4>
                    <h4 class="ptd5" id="ptD5"></h4>
                    <h4 class="ptd6" id="ptD6"></h4>
                    <h4 class="ptd7" id="ptD7"></h4>
                </div>


            </div>
            <button id="remptn" class="delptn">Remove Patient</button>
        </div>

        <div class="chartdiv">
            <canvas class="chartcanvas" id="myChart"></canvas>
            <h2 class="headI">
                Intake Graph
            </h2>

        </div>
        <div class="output_chartdiv">
            <canvas class="outputC" id="outputChart"></canvas>
            <h2 class="headO">
                Output Graph
            </h2>

        </div>
        <div id="viewallpatients" class="allpatients">

            <h1 class="textback">View <br>Patients</h1>
            <a href="/Dashboard/dash.html">
                <button class="back">
                    <span class="material-symbols-outlined">
                        arrow_forward
                    </span>
                </button>
            </a>
        </div>
        <div id="next" class="nextgraph">
            <span class="material-symbols-outlined">
                arrow_forward_ios
            </span>
        </div>
        
    </section>
    <div id="pop" class="popbg">
        <div id="popup" class="popupdiv">

            <span class="material-symbols-outlined" id="closebtn">
                close
            </span>
            <span id="tick" class="material-symbols-outlined">
                done
            </span>
            <h5 id="intext" class="ptdtad">
                Details Updated!
            </h5>
            <a href="/Dashboard/dash.html"><button id="view" class="viewpatients">View Patients</button></a>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-firestore.js"></script>
<script>
    window.onload = function () {
        if (localStorage.getItem('scrollPosition') !== null && localStorage.getItem('formData') !== null) {
            window.scrollTo(0, localStorage.getItem('scrollPosition'));
        }
    }
    function arrangeHours(arr) {
        const newArr = [arr[0]];
        for (let i = 1; i < arr.length; i++) {
            const prevHour = newArr[newArr.length - 1];
            let currHour = arr[i];
            while (currHour <= prevHour) {
                currHour += 24;
            }
            newArr.push(currHour);
        }
        return newArr;
    }
    var firebaseConfig = {

        apiKey: "AIzaSyCo2Fuxil6adrJXYvyw350ClCYKH1lUcMs",

        authDomain: "hackathon--23.firebaseapp.com",

        projectId: "hackathon--23",

        storageBucket: "hackathon--23.appspot.com",

        messagingSenderId: "596815595297",

        appId: "1:596815595297:web:84854bdb064d4737e66060",

        measurementId: "G-VMY2C911KT"

    };


    // Initialize Firebase

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();

    const database = firebase.firestore()
    auth.onAuthStateChanged(doctor => {
        if (!doctor) {
            location.href = "/SignUp/signup.html"
            return;
        }
    })

    auth.onAuthStateChanged(function (user) {
        if (user) {
            let userid = user.uid



            let patientCollection = `patients${userid}`
            let innerhtmlCollection = `innerhtml${userid}`

            let patients = database.collection(patientCollection)
            let name_patient = localStorage.getItem("name_patient").split(" ")
            let innerhtml = database.collection(innerhtmlCollection)



            document.getElementById("ptnf").addEventListener("submit", (e) => {
                e.preventDefault();
            })

            document.getElementById("delacc").addEventListener("click", () => {
                const currentUser = auth.currentUser
                console.log(currentUser)
                currentUser
                    .delete(currentUser)
                    .catch(err => { console.log(err) })
            })

            document.getElementById("sigout").addEventListener("click", () => {
                auth
                    .signOut()
                    .catch(err => console.log(err))
            })

            document.getElementById("closebtn").addEventListener("click", () => {
                document.getElementById('popup').style.display = "none";
                document.getElementById('pop').style.display = "none";
                document.getElementById('tick').innerHTML = "done";
                document.getElementById('tick').style.color = 'greenyellow';
                document.getElementById('tick').style.border = '2px solid greenyellow';
                document.getElementById('view').style.display = "none";
                localStorage.setItem('scrollPosition', window.scrollY);
                location.reload();
            })

            document.getElementById("patientsubmit").addEventListener("click", () => {
            
                //PatientName
                let firstname_patient = document.getElementById("fpn").value;
                let lastname_patient = document.getElementById("lpn").value;

                //time
                let intime = document.getElementById("intym").value;
                let outtime = document.getElementById("outtym").value;

                //intake   
                let bp = document.getElementById("bloodP").value;
                let pulse = document.getElementById("Pulsepn").value;
                let oral_feed = document.getElementById("orngpn").value;

                //output
                let urine = document.getElementById("urpn").value;
                let stool = document.getElementById("stpn").value;
                let vomit = document.getElementById("vmpn").value;
                let suction = document.getElementById("scpn").value;

                array_inputs = [intime, outtime, bp, pulse, oral_feed, urine, stool, vomit, suction]
                for (var i = 0; i < array_inputs.length; i++) {
                    if (array_inputs[i] === "") {

                        document.getElementById('pop').style.display = 'block';
                        document.getElementById('popup').style.display = 'block';
                        document.getElementById('popup').style.height = '270px';
                        document.getElementById('intext').innerHTML = "Please enter all the values!";
                        document.getElementById('tick').innerHTML = "close";
                        document.getElementById('tick').style.color = 'red';
                        document.getElementById('tick').style.border = '2px solid red';


                    }
                }

                patients.get().then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        if (doc.data().first_name === firstname_patient && doc.data().last_name === lastname_patient) {


                            let bparr = doc.data().bparr;
                            let intimearr = doc.data().intimearr;
                            let pulsearr = doc.data().pulsearr;
                            let ofarr = doc.data().ofarr;
                            let outimearr = doc.data().outimearr;
                            let urinearr = doc.data().urinearr;
                            let stoolarr = doc.data().stoolarr;
                            let vomitarr = doc.data().vomitarr;
                            let suctionarr = doc.data().suctionarr;

                            //PatientName
                            let firstname_patient = document.getElementById("fpn").value;
                            let lastname_patient = document.getElementById("lpn").value;

                            //time
                            let intime = document.getElementById("intym").value;
                            let outtime = document.getElementById("outtym").value;

                            //intake   
                            let bp = document.getElementById("bloodP").value;
                            let pulse = document.getElementById("Pulsepn").value;
                            let oral_feed = document.getElementById("orngpn").value;

                            //output
                            let urine = document.getElementById("urpn").value;
                            let stool = document.getElementById("stpn").value;
                            let vomit = document.getElementById("vmpn").value;
                            let suction = document.getElementById("scpn").value;

                            array_inputs = [intime, outtime, bp, pulse, oral_feed, urine, stool, vomit, suction]
                            for (var i = 0; i < array_inputs.length; i++) {
                                if (array_inputs[i] === "") {
                                    alert("Please enter all the values")
                                    return;
                                }
                            }



                            bparr.push(parseInt(bp))
                            intimearr.push(parseInt(intime))
                            pulsearr.push(parseInt(pulse))
                            ofarr.push(parseInt(oral_feed))
                            outimearr.push(parseInt(outtime))
                            urinearr.push(parseInt(urine))
                            stoolarr.push(parseInt(stool))
                            vomitarr.push(parseInt(vomit))
                            suctionarr.push(parseInt(suction))

                            patients.doc(firstname_patient).update({
                                intime: parseInt(intime),
                                outputTime: parseInt(outtime),
                                bp: parseInt(bp),
                                pulse: parseInt(pulse),
                                oral_feed: parseInt(oral_feed),
                                urine: parseInt(urine),
                                stool: parseInt(stool),
                                vomit: parseInt(vomit),
                                suction: parseInt(suction),
                                bparr: bparr,
                                pulsearr: pulsearr,
                                ofarr: ofarr,
                                intimearr: intimearr,
                                outimearr: outimearr,
                                urinearr: urinearr,
                                stoolarr: stoolarr,
                                vomitarr: vomitarr,
                                suctionarr: suctionarr
                            })

                        }
                    });
                })

                document.getElementById("popup").style.display = "block";
                document.getElementById("pop").style.display = "block";
                document.getElementById("view").style.display = "none";
            })



            //Generating Chart
            const ctx = document.getElementById('myChart').getContext('2d');
            let intimearr, bparr, pulsearr, ofarr, sortedIntimeArr;

            patients.get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    if (doc.data().first_name === document.getElementById("fpn").value && doc.data().last_name === document.getElementById("lpn").value || name_patient[0] === doc.data().first_name && name_patient[1] === doc.data().last_name) {
                        intimearr = doc.data().intimearr;
                        sortedIntimeArr = arrangeHours(intimearr)
                        bparr = doc.data().bparr;
                        pulsearr = doc.data().pulsearr;
                        ofarr = doc.data().ofarr;

                        const chart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: sortedIntimeArr,
                                datasets: [{
                                    label: 'Blood Pressure',
                                    data: bparr,
                                    borderColor: 'red',
                                    fill: false,
                                    tension: 0
                                }, {
                                    type: 'bar',
                                    label: 'Blood Pressure',
                                    data: bparr,
                                    backgroundColor: 'orange',
                                    borderWidth: 1,

                                },
                                {
                                    label: 'Pulse',
                                    data: pulsearr,
                                    borderColor: 'blue',
                                    fill: false,
                                    tension: 0
                                }, {
                                    type: 'bar',
                                    label: 'Pulse',
                                    data: pulsearr,
                                    backgroundColor: 'cyan',
                                    borderWidth: 1,


                                }, {
                                    label: 'Oral-Feed',
                                    data: ofarr,
                                    borderColor: 'green',
                                    fill: false,
                                    tension: 0,


                                }, {
                                    type: 'bar',
                                    label: 'Oral-Feed',
                                    data: ofarr,
                                    backgroundColor: 'rgb(144, 238, 144)',
                                    borderWidth: 1,


                                }]
                            },
                            options: {

                                maintainAspectRatio: false,
                                title: {
                                    display: true,
                                    text: 'Fluid Intake'
                                },
                                scales: {
                                    xAxes: [{
                                        barPercentage: 0.6,
                                        categoryPercentage: 0.6,
                                        offset: true,
                                    }],
                                    yAxes: [{
                                        offset: true,
                                    }],
                                    y: {
                                        beginAtZero: true
                                    },
                                    x: {
                                        beginAtZero: true
                                    },
                                }
                            }
                        })



                        // styling the chart
                        chart.canvas.parentNode.style.height = '400px';
                        chart.canvas.parentNode.style.width = '500px';
                        chart.canvas.parentNode.style.padding = '20px';
                        chart.canvas.parentNode.style.marginLeft = '50px';
                        chart.canvas.parentNode.style.marginTop = '-795px';

                        if (localStorage.getItem('current_graph') === 'output') {
                            chart.canvas.parentNode.style.display = 'none';
                        }


                        //Updating the chart
                        chart.update();

                    }
                })
            }
            )





            let outimearr, urinearr, stoolarr, vomitarr, suctionarr, sortedOuttimearr;

            patients.get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    if (doc.data().first_name === document.getElementById("fpn").value && doc.data().last_name === document.getElementById("lpn").value || name_patient[0] === doc.data().first_name && name_patient[1] === doc.data().last_name) {
                        outimearr = doc.data().outimearr;
                        sortedOuttimearr = arrangeHours(outimearr)

                        urinearr = doc.data().urinearr;
                        stoolarr = doc.data().stoolarr;
                        vomitarr = doc.data().vomitarr;
                        suctionarr = doc.data().suctionarr;

                        //Generating Chart
                        const cx = document.getElementById('outputChart').getContext('2d');

                        const output_chart = new Chart(cx, {
                            type: 'line',
                            data: {
                                labels: sortedOuttimearr,
                                datasets: [{
                                    label: 'Urine',
                                    data: urinearr,
                                    borderColor: 'rgba(255, 192, 0)',
                                    fill: false,
                                    tension: 0
                                }, {
                                    type: 'bar',
                                    label: 'Urine',
                                    data: urinearr,
                                    backgroundColor: 'red',
                                    borderWidth: 1
                                }, {
                                    label: 'Stool',
                                    data: stoolarr,
                                    borderColor: 'brown',
                                    tension: 0,
                                    fill: false
                                }, {
                                    type: 'bar',
                                    label: 'Stool',
                                    data: stoolarr,
                                    backgroundColor: 'blue',
                                }, {
                                    label: 'Vomit',
                                    data: vomitarr,
                                    borderColor: 'rgb(154,205,50)',
                                    fill: false,
                                    tension: 0
                                }, {
                                    type: 'bar',
                                    label: 'Vomit',
                                    data: vomitarr,
                                    backgroundColor: 'green',
                                },
                                {
                                    label: 'Suction',
                                    data: suctionarr,
                                    borderColor: 'purple',
                                    fill: false,
                                    tension: 0

                                }, {
                                    type: 'bar',
                                    label: 'Suction',
                                    data: suctionarr,
                                    backgroundColor: 'yellow',
                                }]
                            },
                            options: {

                                maintainAspectRatio: false,
                                title: {
                                    display: true,
                                    text: 'Fluid Output'
                                },
                                scales: {
                                    xAxes: [{
                                        offset: true,
                                    }],
                                    yAxes: [{
                                        offset: true,
                                    }],
                                    y: {
                                        beginAtZero: true,
                                    },
                                    x: {
                                        beginAtZero: true,
                                    }
                                }
                            }
                        })

                        // styling the chart
                        output_chart.canvas.parentNode.style.height = '400px';
                        output_chart.canvas.parentNode.style.width = '500px';
                        output_chart.canvas.parentNode.style.padding = '20px';
                        output_chart.canvas.parentNode.style.marginLeft = '50px';
                        output_chart.canvas.parentNode.style.marginTop = '-795px';
                        if (localStorage.getItem('current_graph') === 'intake') {
                            output_chart.canvas.parentNode.style.display = 'none';
                        }
                        //Updating the chart
                        output_chart.update();


                    }
                })
            }
            )


            //Chart End

            document.getElementById('next').addEventListener('click', () => {
                if (localStorage.getItem('current_graph') === 'output') {
                    localStorage.setItem('current_graph', 'intake');
                }
                else {
                    localStorage.setItem('current_graph', 'output');
                }
                localStorage.setItem('scrollPosition', window.scrollY);
                location.reload();

            })

            if (localStorage.getItem('current_graph') === null) {
                localStorage.setItem('current_graph', 'intake');
            }

            patients.get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    if (doc.data().first_name === document.getElementById("fpn").value && doc.data().last_name === document.getElementById("lpn").value || name_patient[0] === doc.data().first_name && name_patient[1] === doc.data().last_name) {
                        document.getElementById("ptH").innerHTML = "Details about " + name_patient[0] + " " + name_patient[1];

                        //Intake
                        document.getElementById("ptD8").textContent = `Last Intake Time Recorded:-  ${doc.data().intime} Hrs`
                        document.getElementById("ptD1").innerHTML = `Latest Blood Pressure Record:-  ${doc.data().bp}ml`;
                        document.getElementById("ptD2").textContent = `Latest Pulse Record:-  ${doc.data().pulse}ml`
                        document.getElementById("ptD3").textContent = `Latest Oral N.G Feed Record:-  ${doc.data().oral_feed}ml`

                        //Output
                        document.getElementById("ptD9").textContent = `Latest Output Time recorded:-  ${doc.data().outputTime} Hrs`
                        document.getElementById("ptD4").textContent = `Latest Urine Record:-  ${doc.data().urine}ml`
                        document.getElementById("ptD5").textContent = `Latest Stool Record:-  ${doc.data().stool}ml`
                        document.getElementById("ptD6").textContent = `Latest Vomit Record:-  ${doc.data().vomit}ml`
                        document.getElementById("ptD7").textContent = `Latest Suction Record:-  ${doc.data().suction}ml`



                    }
                })
            })

            document.getElementById("remptn").addEventListener("click", () => {
                patients.get().then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        if (doc.data().first_name == name_patient[0]) {
                            patients.doc(name_patient[0]).delete();
                            innerhtml.doc(name_patient[0]).delete();
                        }

                    })
                })

                document.getElementById("popup").style.display = "block";
                document.getElementById("pop").style.display = "block";
                document.getElementById("view").style.display = "block";
                document.getElementById("intext").style.display = "none";
                document.getElementById("closebtn").style.display = "none";
                document.getElementById("tick").style.marginTop = "50px";

            })
        }
    })


</script>

</html>
